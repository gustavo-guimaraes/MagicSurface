angular.module("msvalidator",[]),angular.module("msvalidator").factory("MSValidator",function(){function a(a,e){b=a,c={isValid:!0};for(var f in e){var g=e[f];if(void 0!==d[f]){var h=d[f](g);if(void 0!==h){c=h,c.isValid=!1;break}}else console.error("Ops a rule "+f+" não existe!!")}return c}var b=void 0,c=void 0,d={notEmpty:function(a){for(var c=[],d=0;d<a.length;++d)b[a[d]]||c.push(a[d]);return angular.equals(c,[])?void 0:{msg:"Campos obrigatorios!",fields:c}},existOnly:function(a){var c=[];for(var d in b)-1===a.indexOf(d)&&c.push(d);return angular.equals(c,[])?void 0:{msg:"Ha campos que nao deveriam existir no objeto!",fields:c}},isNumber:function(a){for(var c=[],d=0;d<a.length;++d)void 0!==b[a[d]]&&isNaN(b[a[d]])&&c.push(a[d]);return angular.equals(c,[])?void 0:{msg:"Ha campos que deveriam ser números!",fields:c}},hasId:function(a){var b=angular.isObject(a)&&angular.isUndefined(a.id);return!b&&isNaN(a)?{msg:"Obejot não possui um id!"}:void 0},isFile:function(a){angular.isArray(a)&&(a=a[0]);var b=angular.isObject(a)&&a instanceof File;return b?void 0:{msg:"File inválido, verifique se ele é do tipo File"}}};return{validate:a}}),angular.module("msajax",[]),angular.module("msajax").factory("MSAjax",["$http",function(a){return{get:function(b,c){c||(c={});var d={method:"GET",url:b,params:c};return a(d)},post:function(b,c){c||(c={});var d={method:"POST",url:b,data:c};return a(d)},"delete":function(b,c){c||(c={});var d={method:"delete",url:b,params:c};return a(d)},post_file:function(b,c){c||(c={});var d={method:"POST",url:b,transformRequest:angular.identity,headers:{"Content-Type":void 0},data:c};return a(d)}}}]),angular.module("magicSurface",["msajax","msvalidator"]),angular.module("magicSurface").factory("MagicSurface",function(){function a(a,b){e=a,f=b}function b(){return e}function c(){return f}function d(){return g}var e,f,g="http://magicsurfacebr.appspot.com/";return{getHost:d,getToken:b,getUsername:c,configApp:a}}),angular.module("magicSurface").factory("FileRestApi",["MSAjax","MagicSurface",function(a,b){function c(){return{user_id:h.getUsername(),token:h.getToken()}}function d(b){return console.log(h),b.append("user_id",h.getUsername()),b.append("token",h.getToken()),a.post_file(i,b)}function e(b){return b||(b={}),angular.extend(b,c()),a.get(l,b)}function f(b){return b||(b={}),angular.extend(b,c()),a.get(j,b)}function g(b){return b||(b={}),angular.extend(b,c()),a.get(k,b)}var h=b,i=h.getHost()+"file/upload",j=h.getHost()+"file/list",k=h.getHost()+"file/delete",l=h.getHost()+"file/get";return{save:d,get:e,list:f,del:g}}]),angular.module("magicSurface").factory("FileApi",["MSValidator","FileRestApi","$timeout",function(a,b,c){function d(d,e){var f={success:function(a){f._success=a},error:function(a){f._error=a},"finally":function(a){f._finally=a}};return c(function(){var c={hasId:[e]},g=a.validate(void 0,c);if(g.isValid){var h=new FormData;h.append("layerId",isNaN(e)?e.id:e),h.append("file",d),b.save(h).success(f._success).error(f._error)["finally"](f._finally)}else f._error&&f._error(g),f._finally&&f._finally("")}),f}function e(d){var e={success:function(a){e._success=a},error:function(a){e._error=a},"finally":function(a){e._finally=a}};return c(function(){var c=a.validate(d,{hasId:[d]});if(c.isValid){var f={fileId:isNaN(d)?d.id:d};b.get(f).success(e._success).error(e._error)["finally"](e._finally)}else e._error&&e._error(c),e._finally&&e._finally("")}),e}function f(d){var e={success:function(a){e._success=a},error:function(a){e._error=a},"finally":function(a){e._finally=a}};return c(function(){var c={hasId:[d.layerId]};d.filters||(d.filters={});var f=a.validate(void 0,c);f.isValid?(d.layerId=isNaN(d.layerId)?d.layerId.id:d.layerId,b.list(d).success(e._success).error(e._error)["finally"](e._finally)):(e._error&&e._error(f),e._finally&&e._finally(""))}),e}function g(a){var d={success:function(a){d._success=a},error:function(a){d._error=a},"finally":function(a){d._finally=a}};return c(function(){var c=angular.isObject(a)&&angular.isUndefined(a.id);if(c||!isNaN(a)){var e={FileId:isNaN(a)?a.id:a};b.del(e).success(d._success).error(d._error)["finally"](d._finally)}else d._error&&d._error({msg:"fileId inválido"}),d._finally&&d._finally("")}),d}return{save:d,get:e,list:f,del:g}}]),angular.module("magicSurface").factory("LayerRestApi",["MSAjax","MagicSurface",function(a,b){function c(){return{user_id:h.getUsername(),token:h.getToken()}}function d(b){return b||(b={}),angular.extend(b,c()),a.post(j,b)}function e(b){return b||(b={}),angular.extend(b,c()),a.get(l,b)}function f(b){return b||(b={}),angular.extend(b,c()),a.get(k,b)}function g(b){return b||(b={}),angular.extend(b,c()),a.get(i,b)}var h=b,i=h.getHost()+"layer/delete",j=h.getHost()+"layer/save",k=h.getHost()+"layer/list",l=h.getHost()+"layer/get";return{del:g,save:d,list:f,get:e}}]),angular.module("magicSurface").factory("LayerApi",["LayerRestApi","MSValidator","$timeout",function(a,b,c){function d(d){var e={success:function(a){e._success=a},error:function(a){e._error=a},"finally":function(a){e._finally=a}};return c(function(){var c=b.validate(d,h);c.isValid?a.save(d).success(e._success).error(e._error)["finally"](e._finally):(e._error&&e._error(c),e._finally&&e._finally(""))}),e}function e(d){var e={success:function(a){e._success=a},error:function(a){e._error=a},"finally":function(a){e._finally=a}};return c(function(){void 0===d&&(d={}),isNaN(d)||(d={layerId:d});var c=b.validate(d.layerId,{hasId:[d.layerId]});c.isValid?(d.layerId=isNaN(d.layerId)?d.layerId.id:d.layerId,d.options=void 0===d.options?{}:d.options,a.get(d).success(e._success).error(e._error)["finally"](e._finally)):(e._error&&e._error(c),e._finally&&e._finally(""))}),e}function f(b){var d={success:function(a){d._success=a},error:function(a){d._error=a},"finally":function(a){d._finally=a}};return c(function(){void 0===b&&(b={}),void 0===b.filters&&(b.filters={}),void 0===b.options&&(b.options={}),a.list(b).success(d._success).error(d._error)["finally"](d._finally)}),d}function g(b){var d={success:function(a){d._success=a},error:function(a){d._error=a},"finally":function(a){d._finally=a}};return c(function(){void 0===b&&(b={});var c=angular.isObject(b.layerId)&&angular.isUndefined(b.layerId.id);c||!isNaN(b.layerId)?(void 0===b.options&&(b.options={}),b.layerId=isNaN(b.layerId)?b.layerId.id:b.layerId,a.del(b).success(d._success).error(d._error)["finally"](d._finally)):(d._error&&d._error({msg:"LayerId inválido"}),d._finally&&d._finally(""))}),d}var h={notEmpty:["name","latitude","longitude"]};return{save:d,list:f,get:e,del:g}}]);